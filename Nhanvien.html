<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Doanh thu và hóa đơn</title>
    <link rel="icon" href="—Pngtree—letter h logo design vector_5102688.png" type="image/x-icon">
    <title>HBT Ads</title>
    <link rel="icon"
        href="https://png2.cleanpng.com/dy/45e6cd34d6b60489f2a8f4ed3ac6a02e/L0KzQYm3VsEyN5pth5H0aYP2gLBuTgJwgZJxjOs2ZoLodX7zjBdwNZh3eeJxaXOwdLb6ifdvNWZnSddtMHXkRIHqUfM1NmI9TaoDNUG6QYa5WMc1PmM2UKQBNUOxgLBu/kisspng-royalty-free-logo-graphic-design-5b1ed0ea40c1c4.1858851715287462182653.png"
        type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"
        integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="index.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 56px;
        }

        .container {
            background-color: #ffffff;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
        }

        .table {
            margin-top: 20px;
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .btn-danger:hover {
            background-color: #c82333;
            border-color: #bd2130;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg fixed-top bg-body">
        <div class="container-fluid">
            <a class="navbar-brand" href="index.html">
                <img src="—Pngtree—letter h logo design vector_5102688.png" alt="Logo" height="40" class="mr-2 me-2">
                <span class="h4 align-middle">HBT Ads</span>
            </a>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="Nhanvien.html" aria-expanded="false">
                            <i class="bi bi-check-circle"></i> Xét duyệt thông tin
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="phanhoiykien.html" aria-expanded="false">
                            <i class="bi bi-chat-dots"></i> Nhận phản hồi khách hàng
                        </a>
                    </li>
                    <li class="nav-item dropdown me-5">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                            aria-expanded="false">
                            <i class="bi bi-person-circle"></i> <span id="usernameDisplay">Tài khoản</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="Login.html" id="loginBtn"><i
                                        class="bi bi-box-arrow-in-right"></i> Đăng
                                    Nhập</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="Register.html" id="signupBtn"><i
                                        class="bi bi-person-plus-fill"></i>
                                    Đăng Ký</a></li>
                            <li><a href="#" class="dropdown-item" id="logoutBtn" style="display: none;"><i
                                        class="bi bi-box-arrow-left"></i> Đăng xuất</a></li>
                        </ul>
                    </li>
            </div>
    </nav>
    <div class="container-fluid mt-5">
        <div class="row mt-3">
            <hr>
            <div class="col-md-1 "></div>
            <div class="col-md-9 mt-2">
                <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="index.html" class="text-decoration-none text-black"><i
                                    class="bi bi-house-door"></i> Home </a></li>
                        <li class="breadcrumb-item active" aria-current="page">Xác nhận đơn hàng và xuất hóa đơn</li>
                    </ol>
                </nav>
            </div>
            <div class="col-md-2 ">
            </div>
            <hr>
        </div>
    </div>
    </div>
    <!-- Thêm thẻ div để hiển thị thông tin đơn hàng -->
    <div class="container mt-5">
        <h2>Xác nhận đơn hàng</h2>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Nền tảng</th>
                        <th>Thời hạn</th>
                        <th>Giá tiền</th>
                        <th>Trạng thái</th>
                        <th>Xem chi tiết</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody id="orderList">
                    <!-- Danh sách ý kiến đóng góp sẽ được hiển thị ở đây -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Thêm thẻ div để hiển thị thông tin đơn hàng đã duyệt -->
    <div class="container mt-5">
        <h2>Đơn hàng đã duyệt và chờ thanh toán</h2>
        <div class="table-responsive">
            <table class="table table-striped table-bordered" id="approvedOrders">
                <thead>
                    <tr>
                        <th>STT</th>
                        <th>Nền tảng</th>
                        <th>Thời hạn</th>
                        <th>Giá tiền</th>
                        <th>Trạng thái</th>
                        <th>Xem chi tiết</th>
                        <th>Hóa đơn</th>
                    </tr>
                </thead>
                <tbody id="approvedOrderList">
                    <!-- Danh sách đơn hàng đã duyệt sẽ được hiển thị ở đây -->
                </tbody>
            </table>
        </div>
    </div>
    <!-- Modal -->
    <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Thông tin chi tiết đơn hàng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="submittedInfo">
                    <!-- Nội dung modal sẽ được thay đổi bởi JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ... -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="index.js" defer></script>
    <script>
        $(document).ready(function () {
            // Lấy thông tin đơn hàng từ local storage
            const orders = JSON.parse(localStorage.getItem('orders')) || [];

            // Thêm trạng thái mặc định cho đơn hàng
            orders.forEach(order => {
                order.status = order.status || false; // Mặc định là "Chưa xử lý"
            });

            // Hiển thị danh sách đơn hàng
            const table = $('.table tbody');

            // Trước khi thêm các đơn hàng mới, xóa tất cả các dòng hiện tại trong bảng
            table.empty();

            orders.forEach(function (order, index) {
                // Thay vì sử dụng table.insertRow(), tạo một dòng mới
                const row = $('<tr>').addClass('order-item');

                const cellIndex = $('<td>').html(`<strong>${index + 1}</strong>`);
                const cellPlatform = $('<td>').text(order.platform);
                const cellDuration = $('<td>').text(order.duration);
                const cellPrice = $('<td>').text(`${order.price}`);

                // Hiển thị trạng thái
                const cellStatus = $('<td>').text(order.status ? 'Đã xử lý' : 'Chưa xử lý');

                // Thêm nút xem chi tiết
                const cellViewDetail = $('<td>').html(`<button class="btn btn-primary" onclick="showDetailModal(${index})">Xem thông tin</button>`);

                // Thêm nút duyệt
                const cellActions = $('<td>').html(`<button class="btn btn-primary btn-sm" onclick="approveOrder(${index})" ${order.status ? 'disabled' : ''}>Duyệt</button>`);

                // Thêm các ô vào dòng mới
                row.append(cellIndex, cellPlatform, cellDuration, cellPrice, cellStatus, cellViewDetail, cellActions);

                // Sau khi điều chỉnh dòng đơn hàng, thêm nó vào cuối bảng
                table.append(row);
            });

            // Sự kiện khi đóng modal
            $('#detailModal').on('hidden.bs.modal', function (event) {
                clearURLParameters();
            });

            // Hiển thị danh sách đơn hàng đã duyệt và chờ thanh toán
            const approvedTable = $('#approvedOrders').find('tbody');

            // Trước khi thêm các đơn hàng mới, xóa tất cả các dòng hiện tại trong bảng đã duyệt
            approvedTable.empty();

            orders.forEach(function (order, index) {
                // Kiểm tra xem đơn hàng đã duyệt và chờ thanh toán chưa
                if (order.status && !order.paymentStatus) {
                    // Thay vì sử dụng table.insertRow(), tạo một dòng mới
                    const row = $('<tr>').addClass('order-item');

                    const cellIndex = $('<td>').html(`<strong>${index + 1}</strong>`);
                    const cellPlatform = $('<td>').text(order.platform);
                    const cellDuration = $('<td>').text(order.duration);
                    const cellPrice = $('<td>').text(`${order.price} VND`);

                    // Hiển thị trạng thái
                    const cellStatus = $('<td>').text('Đã xử lý');

                    // Thêm ô thanh toán
                    const cellPayment = $('<td>').html(`<button class="btn btn-primary" onclick="generateInvoice(${index})">Xuất hóa đơn</button>`);

                    // Thêm nút xem chi tiết
                    const cellViewDetail = $('<td>').html(`<button class="btn btn-primary" onclick="showDetailModal(${index})">Xem thông tin</button>`);

                    // Thêm các ô vào dòng mới
                    row.append(cellIndex, cellPlatform, cellDuration, cellPrice, cellStatus, cellViewDetail, cellPayment);

                    // Sau khi điều chỉnh dòng đơn hàng, thêm nó vào cuối bảng đã duyệt
                    approvedTable.append(row);
                }
            });
        });

        // Hàm xem chi tiết và hiển thị modal
        function showDetailModal(index) {
            const order = orders[index];
            const modalBody = $('#submittedInfo');

            modalBody.html(`
        <table class="table table-striped table-bordered mt-3">
            <thead class="thead-dark">
                <tr>
                    <th scope="row">Tiêu Đề</th>
                    <td id="submittedTitle">${order.title}</td>
                </tr>
                <tr>
                    <th scope="row">Ghi Đường Dẫn Link</th>
                    <td id="submittedLink">${order.link}</td>
                </tr>
                <tr>
                    <th scope="row">Ảnh hoặc Video</th>
                    <td id="submittedImage"><img src="${order.imageUrl}" alt="Image" style="max-width: 100%;"></td>
                </tr>
                <tr> <!-- Thêm dòng mới để hiển thị trạng thái -->
                    <th scope="row">Trạng thái</th>
                    <td>${order.status ? 'Đã xử lý' : 'Chưa xử lý'}</td>
                </tr>
            </thead>
        </table>
    `);

            // Hiển thị modal
            const modal = new bootstrap.Modal(document.getElementById('detailModal'));
            modal.show();
        }

        // Hàm duyệt đơn hàng
        function approveOrder(index) {
            const confirmation = confirm('Bạn có chắc chắn muốn duyệt đơn hàng này không?');
            if (confirmation) {
                orders[index].status = true; // Đánh dấu là "Đã xử lý"
                localStorage.setItem('orders', JSON.stringify(orders));
                // Sau khi cập nhật trạng thái, cập nhật lại danh sách đơn hàng trong bảng
                updateOrderList();
                location.reload();
            }
        }

        // Hàm cập nhật lại danh sách đơn hàng trong bảng
        function updateOrderList() {
            // Trước khi thêm các đơn hàng mới, xóa tất cả các dòng hiện tại trong bảng
            table.empty();

            orders.forEach(function (order, index) {
                const row = $('<tr>').addClass('order-item');

                const cellIndex = $('<td>').html(`<strong>${index + 1}</strong>`);
                const cellPlatform = $('<td>').text(order.platform);
                const cellDuration = $('<td>').text(order.duration);
                const cellPrice = $('<td>').text(`${order.price}`);
                const cellStatus = $('<td>').text(order.status ? 'Đã xử lý' : 'Chưa xử lý');

                // Thêm nút xem chi tiết
                const cellViewDetail = $('<td>').html(`<button class="btn btn-primary" onclick="showDetailModal(${index})">Xem thông tin</button>`);

                // Thêm nút duyệt
                const cellActions = $('<td>').html(`<button class="btn btn-primary btn-sm" onclick="approveOrder(${index})" ${order.status ? 'disabled' : ''}>Duyệt</button>`);

                // Thêm các ô vào dòng mới
                row.append(cellIndex, cellPlatform, cellDuration, cellPrice, cellStatus, cellViewDetail, cellActions);

                // Sau khi điều chỉnh dòng đơn hàng, thêm nó vào cuối bảng
                table.append(row);
            });
        }

        // Hàm tạo hóa đơn và chuyển hướng qua trang Hoadon.html
        function generateInvoice(index) {
            // Lấy thông tin đơn hàng từ danh sách đã duyệt
            const order = orders.filter(order => order.status)[index];

            // Chuyển hướng qua trang Hoadon.html
            window.location.href = 'Hoadon.html';
        }

        // Hàm xóa tham số URL sau khi đóng modal
        $('#detailModal').on('hidden.bs.modal', function (event) {
            clearURLParameters();
        });

        // Hàm xóa tham số URL
        function clearURLParameters() {
            const newURL = window.location.origin + window.location.pathname;
            window.history.replaceState({}, document.title, newURL);
        }
    </script>
</body>

</html>